"use strict";define(["underscore","jquery","backbone",window.Game.js_url_list.network,window.Game.js_url_list.play_part,window.Game.js_url_list.fader,window.Game.js_url_list.option,window.Game.js_url_list.util,window.Game.js_url_list.option_storage],function(e,i,t,s,n,l,a,c,r){var o=t.View.extend({el:"#drum_master",template:e.template(i("#stage_select_template").html()),selectInfo:{level:{},id:1},music_list:window.Game.music_record_info,music_name_list:{1:"easy",2:"normal",3:"hard"},events:{"click .js_select_difficulty":"selectDifficulty","click .js_play_music":"getStageInfo","click .js_music_select":"selectMusic","click .js_option_menu":"optionMenu"},currentKey:null,initialize:function(){this.startProcess(),this.clickable=!0;var e=this;i("#drum_master").on("webkitTransitionEnd",".js_music_select",function(){e.clickable=!0})},startProcess:function(){this.music_list?(this.network=new s(e.bind(this.startPlay,this)),this.option_menu=new a(this),this.uniteResource()):this.resource()},uniteResource:function(){var i=[];for(var t in this.music_list)this.selectInfo.level[t]=1,i.push(window.Game.js_url_list["music_info_"+t]);require(i,e.bind(this.prepareViewModel,this))},resource:function(){require([window.Game.js_url_list["music_info_"+window.Game.music_id]],e.bind(this.prepareViewModel,this))},prepareViewModel:function(){var i=Array.prototype.slice.call(arguments),s={},n={};for(var l in i){var a=parseInt(l)+1;s[a]=i[l].status,n[a]=i[l]}this.music_status=s,this.music_infos=n;var r=t.Model.extend({defaults:{selectInfo:this.selectInfo,music_list:this.music_list,music_name_list:this.music_name_list,music_status:this.music_status,util:c}});this.model=new r,c.setSE().done(e.bind(this.readySE,this)).fail(function(){alert("読み込みに失敗しました。")})},readySE:function(){window.bgm_pause(),void 0==window.Game.notes?this.render():(this.selectInfo.id=1,this.startPlay({music_id:window.Game.music_id,difficulty:window.Game.difficulty,notes:window.Game.notes}))},render:function(){this.$el.html(this.template(this.model.attributes))},getStageInfo:function(e){c.playSE("don");var t=i(e.currentTarget).find("form");return this.network.send(t[0].action,t.serialize()),l.fadeout(),!1},startPlay:function(i){var t={id:i.music_id,level:i.difficulty};this.playPart=new n(e.extend(i,this.music_infos[this.selectInfo.id],{info:t}))},selectDifficulty:function(e){if(this.selectInfo.id==i(e.currentTarget).parent().parent().data("id")&&this.clickable){c.playSE("ka");var t=i(e.currentTarget).data("level");this.selectInfo.level[this.selectInfo.id]=t,this.render()}},selectMusic:function(e){if(!i(e.currentTarget).hasClass("_selected")&&this.clickable){this.clickable=!1,c.playSE("ka");var t=this,s=i(e.currentTarget).data("id");this.selectInfo.id=s;var n=i(".js_music_select");n.each(function(e){var i=n.eq(e);i.data("id")==s?i.addClass("_selected"):i.removeClass("_selected")}),i(".js_play_music").find("input[name=music_id]").val(s).end().find("input[name=difficulty]").val(t.selectInfo.level[s])}},optionMenu:function(e){c.playSE("don"),this.option_menu.fadeOut()}});return o});