"use strict";define(["underscore","jquery","backbone",window.Game.js_url_list.const,window.Game.js_url_list.util],function(t,i,o,n,s){var e=(window.createjs,function(t,o,e,a){this.types={don:"don",ka:"ka"},this.Judge=[{rate:0,name:"excellent",total:0},{rate:0,name:"good",total:0},{rate:0,name:"bad",total:0}],this.Key=n.DECISION_KEY;for(var _ in this.Judge)this.Judge[_].rate=o.judge[this.Judge[_].name];this.outOfRange=this.Judge[2].rate,this.$judge=i("#judge"),this.timer=null,this.combo_count=t,this.gauge=e,this.soul_effect=a,this.norma_point=0,this.norma_min=0,this.norma_max=o.common.gauge.limit,this.norma_add=o.common.gauge.add,this.norma_add_multipy=1/this.norma_add,this.status=o.status[s.convertKeyName(o.info.level)],this.hit_zone_pow=n.HIT_ZONE_WIDTH*n.HIT_ZONE_WIDTH,this.don_pure=n.HIT_ZONE_WIDTH*o.big_note.don*.01,this.ka_pure=n.HIT_ZONE_WIDTH*o.big_note.ka*.01,this.don_pure_pow=this.don_pure*this.don_pure,this.ka_pure_pow=this.ka_pure*this.ka_pure}),a=e.prototype;return a.getHitType=function(t,i){if(i<n.HIT_ZONE_TOP||i>n.HIT_ZONE_BOTTOM)return"";var o=n.HIT_ZONE_IN_DRUM_X-t,s=n.HIT_ZONE_IN_DRUM_Y-i,e=o*o+s*s;return e<this.hit_zone_pow?this.types.don+1*(e<=this.don_pure_pow):this.types.ka+1*(e<=this.ka_pure_pow)},a.showJudge=function(t){clearTimeout(this.timer);var i=this;this.$judge.removeClass().addClass(t+" start_effect"),setTimeout(function(){i.$judge.removeClass("start_effect")},50),this.timer=setTimeout(function(){i.$judge.removeClass()},500)},a.comboCount=function(t){"excellent"==t||"good"==t?this.combo_count.addCombo():this.combo_count.deleteCombo(),this.Judge[this.Key[t]].total++,this.calc_norma(t)},a.calc_norma=function(t){var o=this.norma_point;this.norma_point+=this.status[t],this.norma_point>this.norma_max?this.norma_point=this.norma_max:this.norma_point<this.norma_min&&(this.norma_point=this.norma_min),null!==this.soul_effect&&(o!=this.norma_point&&this.norma_point==this.norma_max?this.soul_effect.fireAnimationStart():o==this.norma_max&&this.norma_max!=this.norma_point&&this.soul_effect.fireAnimationEnd()),void 0==this.$n_point&&(this.$n_point=i("#n_point")),this.$n_point.length&&this.$n_point.text(this.norma_point);var n=Math.floor(this.norma_point*this.norma_add_multipy);n>this.gauge.num?this.gauge.add():n<this.gauge.num&&this.gauge.sub()},a.getResult=function(){var t="failure";return this.norma_max==this.norma_point?t="great_success":this.status.clearline<=this.norma_point?t="success":.5*this.status.clearline<=this.norma_point&&(t="dear"),t},a.is_fullcombo=function(t){return this.status.fullcombo==t},a.getDecision=function(t){return this.Judge[this.Key[t]].total},e});