"use strict";define(["jquery",window.Game.js_url_list.const,window.Game.js_url_list.tone,window.Game.js_url_list.option_storage,window.Game.js_url_list.util],function(t,e,i,a,o){var s=function(e,o,s){this.iterator=e,this.State=e.State,this.type=o,this.zoom=s,this["$"+this.type]=t("#"+this.type),this["$"+this.type+"_span"]=this["$"+this.type].find("span"),this.$char_don=t("#char_don"),this.use_animation=a.canUseEffect(this.iterator.parent.songData.option.kusudama_animation);var n=this;this.type==i.Special.kusudama&&this.use_animation&&this.iterator.parent.paper_ball.addEventListener("ready",function(){console.log("ready listener"),n["$"+n.type].show()})},n=s.prototype;return n.makeSpecial=function(t,e){return this["make_"+this.type](t,e)},n.make_balloon=function(t,e){var i=t.note,a=!1;if(t.state==t.ShowState.ready)t.state=t.ShowState.on,t.count=i.count-1,t.multi=this.zoom/i.count,t.motion=1,this.setNumber(t.count),this["$"+this.type].show(),this.setup_animation(this.type+"_wait"),this.$char_don.attr("data-type",t.motion),t.hide();else if(t.state==t.ShowState.on)if(t.count--,t.count){this.setup_animation(this.type+"_act");var s=Math.round((i.count-t.count)*t.multi);this.$char_don.attr("data-type",s),this.setNumber(t.count),this["$"+this.type].show()}else this.iterator.changeToWait(t,this.iterator.State.End),this["$"+this.type+"_span"].removeClass(),this["$"+this.type].hide(),this.setup_animation(this.type+"_good"),this.$char_don.attr("data-type",this.zoom+2),t.motion=0,this.iterator.effect_circle&&this.iterator.effect_circle.throwEffect("don_str"),o.playSE("balloon"),a=!0;return a},n.make_kusudama=function(t,i){var a=t.note,s=!1;if(t.state==t.ShowState.on)if(t.count--,t.count)this.setup_animation(this.type+"_act"),this.setNumber(t.count),this["$"+this.type].show();else{this.iterator.changeToWait(t,this.iterator.State.End),this["$"+this.type+"_span"].removeClass(),this["$"+this.type].hide();var n=this;this.use_animation?setTimeout(function(){n.setup_animation(n.type+"_good"),o.isExcellent(a,i)?(n.iterator.parent.paper_ball.excellent(n.iterator.fever.is_fever()),s=5e3*(n.iterator.fever.is_fever()?1.2:1),o.playSE("paper_great")):(n.iterator.parent.paper_ball.good(n.iterator.fever.is_fever()),s=1e3*(n.iterator.fever.is_fever()?1.2:1),o.playSE("paper_good"))},e.QUARTER_FPS):setTimeout(function(){n.setup_animation(n.type+"_good_lite");var t=1e3;o.isExcellent(a,i)?(o.playSE("paper_great"),t*=5):o.playSE("paper_good"),n.iterator.fever.is_fever()&&(t*=1.2),n.$char_don.attr("data-point",t),n.kusudama_timeout(2),s=t},e.QUARTER_FPS)}return s},n.kusudama_timeout=function(t){var e=this,i=setTimeout(function(){return t>5?void clearTimeout(i):(e.$char_don.attr("data-type",t),void e.kusudama_timeout(++t))},100)},n.setup_animation=function(t){this.iterator.parent.bg_effect.setup_animation(t)},n.setNumber=function(t){var e=t.toString().split("");this["$"+this.type+"_span"].removeClass();for(var i in e)this["$"+this.type+"_span"].eq(i).addClass("no_"+e[i])},n.setReady=function(t){if(this.type!=i.Special.kusudama)return void(t.state=t.ShowState.ready);t.state=t.ShowState.on;var a=t.note;t.count=a.count,t.multi=this.zoom/a.count,this.setNumber(t.count),this.setup_animation(this.type+"_wait");var o=this;setTimeout(function(){o.use_animation?o.iterator.parent.paper_ball.appear():(o.$char_don.attr("data-type",1),o["$"+o.type].show())},e.QUARTER_FPS)},n.bad_animation=function(){if(this.type==i.Special.kusudama&&this.use_animation){var t=this;setTimeout(function(){t.iterator.parent.paper_ball.bad(),o.playSE("paper_bad")},e.QUARTER_FPS)}},s});