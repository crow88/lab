"use strict";define(["jquery",window.Game.js_url_list.cjs010_additional_score,window.Game.js_url_list.const],function(s,t,e){var i=new Array(2),r=0,o=function(t,r,o,n){if(this.status=t,this.option=o,this.option){this.fps_interval=e.FPS_INTERVAL_8,this._timer=0,this.score_effect_stage=n;for(var a=0;a<i.length;a++){var d=new window.lib.cjs010_additional_score_additional_score;d.x=124,d.y=165,d.gotoAndStop("appear"),d.visible=!1,this.score_effect_stage.addChild(d),i[a]=d}this.add_render=this.add_cjs_render}else this.add_render=this.add_css_render,this.$add_score=s("#add_score"),this.$backup_score=s("#backup_score"),this.$add_score_span=this.$add_score.find("span");this.combo_count=r,this.$score_table=s("#score_table"),this.$score_span=this.$score_table.find("span"),this.$bonus_score=s("#bonus_score"),this.score_timer=!1,this.total_point=0,this.deferred_list=[],this.base={excellent:this.status.base_score,good:.5*this.status.base_score,combo:this.status.combo_score},this.multiply={1:0,10:.25,30:.5,50:1,100:2}},n=o.prototype;return n.tick=function(s){s-this._timer>=this.fps_interval&&(this._timer=s,this.score_effect_stage.update())},n.update=function(s,t,e,i,r){var o=this.search(void 0==r?this.combo_count.combo:r),n=10*Math.floor((this.base[s]+this.base.combo*this.multiply[o])*(t?.12:.1))*(e&&i?2:1);this.total_point+=n,this.add_render(n),this.render()},n.justUpdate=function(){this.total_point+=1e4,this.bonus_render(),this.render()},n.search=function(s){var t=null;for(var e in this.multiply){if(e>s)break;t=e}return t},n.update_renda=function(s,t){var e=s?200:100;e*=t?1.2:1,this.total_point+=e,this.add_render(e),this.render()},n.update_special=function(s,t,e){this["update_"+s](t,e)},n.update_balloon=function(s,t){var e=(s?5e3:300)*(t?1.2:1);this.total_point+=e,this.add_render(e),this.render()},n.update_kusudama=function(s,t){var e=s?s:300*(t?1.2:1);this.total_point+=e,this.add_render(e),this.render()},n.render=function(){var s=this.total_point.toString();this.$score_span.removeClass();for(var t in s)this.$score_span.eq(t).addClass("no_"+s[t])},n.add_cjs_render=function(s){i[r].gotoAndPlay("appear");var t=i[(r+1)%2];t.currentFrame<t.timeline._labels.disappear&&t.gotoAndPlay("disappear"),i[r].visible=!0;for(var e,o=s.toString(),n=5-o.length,a=0;a<5;a++)e=a<n?"empty":"n"+o[a-n],i[r].num_set["d"+(a+1)].gotoAndStop(e);r=++r%i.length},n.add_css_render=function(t){clearTimeout(this.score_timer);var e=this.deferred_list.shift();e&&e.reject();var i=t.toString();this.$add_score_span.removeClass(),this.$add_score.css("visibility","visible");for(var r in i)this.$add_score_span.eq(r).addClass("score_"+i[r]);var o=this,n=s.Deferred();n.done(function(){o.$add_score.addClass("encount"),setTimeout(function(){o.$add_score.css("visibility","hidden"),o.$add_score.removeClass("encount")},300)}).fail(function(){o.$backup_score.empty(),o.$backup_score.append(o.$add_score_span.clone()),o.$backup_score.addClass("encount"),setTimeout(function(){o.$backup_score.empty(),o.$backup_score.removeClass("encount")},300)}),this.deferred_list.push(n),this.score_timer=setTimeout(function(){n.resolve(),o.deferred_list.shift()},300)},n.bonus_render=function(){this.$bonus_score.css("visibility","visible");var s=this;setTimeout(function(){s.$bonus_score.css("visibility","hidden")},500)},o});