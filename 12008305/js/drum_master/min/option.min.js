"use strict";define(["underscore","jquery","backbone",window.Game.js_url_list.fader,window.Game.js_url_list.option_storage,window.Game.js_url_list.const,window.Game.js_url_list.util,window.Game.js_url_list.network],function(e,t,n,i,s,o,r,a){var l=n.View.extend({el:"#drum_master",template:e.template(t("#option_menu_template").html()),initialize:function(e){this.stage_select=e,this.select_model=new d,window.Game.useSetting&&(this.network=new a(r.doNoting),this.$option_form=t("#option_form"))},fadeOut:function(){i.addEventListener("fadeoutComplete",e.bind(this.openMenu,this)),i.fadeout()},openMenu:function(){this.select_model.set("perfomance",s.getPerfomance()),this.select_model.set("seSave",s.getSeSetting()),t("#drum_master").empty(),this.render(),i.fadein(),this.events={"click .js_return":"returnBtn","click .perfomance_radio":"optionSelected","click .se_radio":"seSelected","click .js_apply":"optionSave"},this.delegateEvents(this.events)},render:function(){this.$el.html(this.template(this.select_model.attributes))},returnBtn:function(){i.removeEventListener("fadeoutComplete",e.bind(this.render,this)),i.addEventListener("fadeoutComplete",e.bind(this.returnStageSelect,this)),r.playSE("ka"),i.fadeout()},returnStageSelect:function(){i.removeEventListener("fadeoutComplete",e.bind(this.returnStageSelect,this)),t("#drum_master").empty();var n=this;setTimeout(function(){o.refresh(),s.getSeSetting()&&!r.seReady?r.setSE().done(function(){n.stage_select.render(),i.fadein()}):(n.stage_select.render(),i.fadein())},500)},optionSelected:function(e){var n=t(e.currentTarget).data("id");return this.select_model.get("perfomance")!=n&&(r.playSE("ka"),this.select_model.set("perfomance",n),this.render(),!1)},webglSelected:function(e){var n=t(e.currentTarget).data("id");return this.select_model.get("webgl")!=n&&(r.playSE("ka"),this.select_model.set("webgl",n),this.render(),!1)},seSelected:function(e){var n=t(e.currentTarget).data("id");return this.select_model.get("seSave")!=n&&(r.playSE("ka"),this.select_model.set("seSave",n),this.render(),!1)},optionSave:function(){return r.playSE("don"),s.setPerfomance(this.select_model.get("perfomance")),s.setSeSetting(this.select_model.get("seSave")),window.Game.useSetting&&this.network.send(this.$option_form[0].action,this.$option_form.serialize()),i.removeEventListener("fadeoutComplete",e.bind(this.returnStageSelect,this)),i.addEventListener("fadeoutComplete",e.bind(this.returnStageSelect,this)),i.fadeout(),!1}}),d=n.Model.extend({defaults:{perfomance:s.getPerfomance(),webgl:s.getWebGLSetting(),seSave:s.getSeSetting(),perfomance_label:{1:"low",2:"middle",3:"high"},se_label:{0:"off",1:"on"},webgl_label:{0:"off",1:"on"}}});return l});