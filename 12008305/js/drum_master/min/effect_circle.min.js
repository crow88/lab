"use strict";define([window.Game.js_url_list.const,window.Game.js_url_list.tone_sprite,window.Game.js_url_list.option_storage],function(i,t,s){var a={Ready:"Ready",Throw:"Throw",End:"End"},e=function(t,a,e){this.stage=t,this.sprite_manger=a,this.soul_effect=e,this.fps=3==s.getPerfomance()?60:30,this.speed=400,this.finish_fps=1,this.fps_base=Math.floor(i.FPS/this.fps)-1,this.fps_count=0,this.start_radian=Math.atan(Math.abs(i.GOAL_Y-i.EFFECT_CIRCLE_Y)/Math.abs(i.GOAL_X-i.EFFECT_CIRCLE_X)),this.finish_radian=.5*Math.PI+Math.atan(Math.abs(i.EFFECT_GOAL_X-i.EFFECT_CIRCLE_X)/Math.abs(i.EFFECT_GOAL_Y-i.EFFECT_CIRCLE_Y)),this.speedForRadian=(this.finish_radian-this.start_radian)/this.speed,this.effect_finish=this.finish_radian+this.speedForRadian*this.fps_base,this.sprite={},this.sprite.don=[],this.sprite.ka=[],this.sprite.don_str=[],this.sprite.ka_str=[],this.use_cache=3!=s.getPerfomance(),this.previous_position=null,this.cache_data=[],this.draw_list=[],this.count=0,this.tick=this.setPeviousPosition,this.use_cache?this.sprite_init=this.sprite_init_cache:this.sprite_init=this.sprite_init_calculate,this.init()},h=e.prototype;return h.init=function(){if(this.use_cache){for(var i=this.start_radian;i<=this.finish_radian;i+=this.speedForRadian)this.calculate_cache(i);this.calculate_cache(this.finish_radian)}},h.makeCache=function(){for(var i in this.sprite)for(var s=0;s<15;s++)this.sprite[i].push(new t(i,this.stage,this.sprite_manger)),this.sprite[i][this.sprite[i].length-1].state=a.Ready,this.count++;for(var i in this.sprite)for(var s=0;s<15;s++)this.sprite[i].push(new t(i,this.stage,this.sprite_manger)),this.sprite[i][this.sprite[i].length-1].state=a.Ready,this.count++},h.throwEffect=function(i){var s=this.sprite[i],e=null,h=null;for(var n in s)if(s[n].state==a.Ready){e=s[n],h=n;break}null===e&&(s.push(new t(i,this.stage,this.sprite_manger)),h=s.length-1,e=s[h],this.count++),this.sprite_init(e),e.show(),e.state=a.Throw,this.draw_list.push(e)},h.sprite_init_cache=function(i){i.cache_num=0},h.sprite_init_calculate=function(i){i.radian=this.start_radian},h.effectTick=function(i){if(!this.draw_list.length)return void(this.previous_position=i);if(this.fps_count)return void this.fps_count--;var t=i-this.previous_position;this.render(t),this.fps_count=this.fps_base,this.previous_position=i},h.setPeviousPosition=function(i){this.previous_position=i,this.tick=this.effectTick,this.use_cache?this.render=this.render_cache:this.render=this.render_calculate},h.render_calculate=function(i){var t=0;for(var s in this.draw_list){var e=this.draw_list[s];e.radian==this.finish_radian?e.finish_fps==this.finish_fps?(e.state=a.End,e.hide(),e.radian=this.start_radian,e.finish_fps=0,this.calculate(e),t++,this.soul_effect&&this.soul_effect.makeHitEffect()):e.finish_fps++:(this.calculate(e),e.radian+=this.speedForRadian*i,e.radian>=this.finish_radian&&(e.radian=this.finish_radian,e.finish_fps=0))}if(t)for(var s=0;s<t;s++){var h=this.draw_list.shift();h.state=a.Ready}},h.render_cache=function(i){var t=0;for(var s in this.draw_list){var e=this.draw_list[s];if(e.cache_num==this.speed)if(e.finish_fps==this.finish_fps){e.state=a.End,e.hide(),e.finish_fps=0;var h=this.cache_data[0];e.sprite.x=h.x,e.sprite.y=h.y,t++,this.soul_effect&&this.soul_effect.makeHitEffect()}else e.finish_fps++;else{var h=this.cache_data[e.cache_num];void 0!=h?(e.sprite.x=h.x,e.sprite.y=h.y):console.log("noting",e.cache_num,i),e.cache_num+=Math.round(i),e.cache_num>this.speed-1&&(e.cache_num=this.speed,e.finish_fps=0)}}if(t)for(var s=0;s<t;s++){var n=this.draw_list.shift();n.state=a.Ready}},h.calculate=function(t){t.sprite.x=i.EFFECT_CIRCLE_X-Math.cos(t.radian)*i.EFFECT_CIRCLE_RADIUS,t.sprite.y=i.EFFECT_CIRCLE_Y-Math.sin(t.radian)*i.EFFECT_CIRCLE_RADIUS},h.calculate_cache=function(t){var s={};s.x=i.EFFECT_CIRCLE_X-Math.cos(t)*i.EFFECT_CIRCLE_RADIUS,s.y=i.EFFECT_CIRCLE_Y-Math.sin(t)*i.EFFECT_CIRCLE_RADIUS,this.cache_data.push(s)},e});